{% extends 'base.html.twig' %}

{% block title %}Liste des réservations{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>Liste des réservations</h1>

        <div id="search-form-container">
            {{ form_start(form, {'attr': {'id': 'search-form'}}) }}
            {{ form_row(form.startDate) }}
            {{ form_row(form.endDate) }}
            {{ form_row(form.status) }}
            <button type="submit" class="btn btn-primary">Rechercher</button>
            {{ form_end(form) }}
        </div>

        <div id="results-container" class="mt-4">
            {% include 'reservation/_results.html.twig' with {'reservations': reservations} %}
        </div>

        <a href="{{ path('app_reservation_new') }}" class="btn btn-success mt-3">Nouvelle réservation</a>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('search-form');
            const resultsContainer = document.getElementById('results-container');

            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(form);

                fetch('{{ path('app_reservation_index') }}', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                }).then(response => response.text())
                  .then(html => {
                      resultsContainer.innerHTML = html;
                  }).catch(error => {
                      console.error('Error:', error);
                  });
            });
        });
    </script>
{% endblock %}